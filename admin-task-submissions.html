<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>任务提交情况 - 管理后台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="miniprogram-container">
        <!-- 导航栏 -->
        <div class="navbar" style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%);">
            <div class="flex items-center justify-between w-full">
                <div class="flex items-center">
                    <button class="mr-3 text-white" onclick="goBack()">
                        <i class="fas fa-arrow-left text-lg"></i>
                    </button>
                    <h1 class="text-lg font-bold">
                        <i class="fas fa-users mr-2"></i>
                        任务提交情况
                    </h1>
                </div>
            </div>
        </div>

        <!-- 任务信息 -->
        <div class="bg-white mx-3 mt-3 rounded-xl shadow-sm p-5">
            <div class="mb-4">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="font-bold text-xl">周末大促销活动</h2>
                    <span class="status-badge status-pending">进行中</span>
                    </div>
                <p class="text-sm text-gray-600 mb-3">转发促销推文到朋友圈</p>
                <div class="flex items-center text-sm text-gray-500 bg-gray-50 rounded-lg px-3 py-2">
                    <i class="fas fa-calendar-alt mr-2 text-blue-500"></i>
                    <span>2024-12-20 09:00 至 今日 18:00</span>
                </div>
            </div>
            
            <!-- 统计概览 -->
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-blue-50 rounded-lg p-3 text-center">
                    <div class="text-2xl font-bold text-blue-600">15</div>
                    <div class="text-xs text-gray-600 mt-1">总人数</div>
                </div>
                <div class="bg-green-50 rounded-lg p-3 text-center">
                    <div class="text-2xl font-bold text-green-600">12</div>
                    <div class="text-xs text-gray-600 mt-1">已提交</div>
                </div>
                <div class="bg-orange-50 rounded-lg p-3 text-center">
                    <div class="text-2xl font-bold text-orange-600">3</div>
                    <div class="text-xs text-gray-600 mt-1">未提交</div>
                </div>
                <div class="bg-purple-50 rounded-lg p-3 text-center">
                    <div class="text-2xl font-bold text-purple-600">80%</div>
                    <div class="text-xs text-gray-600 mt-1">完成率</div>
                </div>
            </div>
        </div>


        <!-- 人员列表 -->
        <div class="px-3 py-4">
            <!-- 未提交人员 -->
            <div>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-bold text-lg flex items-center">
                        <i class="fas fa-clock text-orange-600 mr-2"></i>
                        未提交 (3人)
                    </h3>
                    <span class="text-sm text-gray-500 bg-orange-50 px-2 py-1 rounded-full">剩余2.5h</span>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex space-x-2 mb-4">
                    <button class="flex-1 bg-orange-500 text-white py-2 px-3 rounded-lg text-sm font-medium" onclick="remindAllNotSubmitted()">
                        <i class="fas fa-bell mr-1"></i>全部提醒
                    </button>
                    <button class="flex-1 bg-gray-100 text-gray-600 py-2 px-3 rounded-lg text-sm font-medium" onclick="exportNotSubmitted()">
                        <i class="fas fa-download mr-1"></i>导出名单
                    </button>
                </div>
                
                <div class="space-y-3">
                    <!-- 未提交人员1 -->
                    <div class="bg-white rounded-xl shadow-sm p-4 not-submitted-person" data-status="not-submitted">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-base">赵六</h4>
                                <p class="text-sm text-gray-500 mt-1">深圳南山店 • 销售员</p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-orange-600 mb-1">未提交</div>
                                <div class="text-xs text-gray-400">2小时前</div>
                            </div>
                        </div>
                        <div class="mt-3 flex items-center justify-between">
                            <div class="text-sm text-orange-600 bg-orange-50 px-2 py-1 rounded-lg">
                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                即将到期
                            </div>
                            <button class="bg-orange-500 text-white text-xs px-3 py-1 rounded-lg" onclick="remindUser('user4')">
                                <i class="fas fa-bell mr-1"></i>提醒
                            </button>
                        </div>
                    </div>

                    <!-- 未提交人员2 -->
                    <div class="bg-white rounded-xl shadow-sm p-4 not-submitted-person" data-status="not-submitted">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-base">孙七</h4>
                                <p class="text-sm text-gray-500 mt-1">杭州西湖店 • 店长</p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-orange-600 mb-1">未提交</div>
                                <div class="text-xs text-gray-400">1小时前</div>
                            </div>
                        </div>
                        <div class="mt-3 flex items-center justify-between">
                            <div class="text-sm text-orange-600 bg-orange-50 px-2 py-1 rounded-lg">
                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                即将到期
                            </div>
                            <button class="bg-orange-500 text-white text-xs px-3 py-1 rounded-lg" onclick="remindUser('user5')">
                                <i class="fas fa-bell mr-1"></i>提醒
                            </button>
                        </div>
                    </div>

                    <!-- 未提交人员3 -->
                    <div class="bg-white rounded-xl shadow-sm p-4 not-submitted-person" data-status="not-submitted">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-base">周八</h4>
                                <p class="text-sm text-gray-500 mt-1">成都春熙店 • 销售员</p>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-orange-600 mb-1">未提交</div>
                                <div class="text-xs text-gray-400">30分钟前</div>
                            </div>
                        </div>
                        <div class="mt-3 flex items-center justify-between">
                            <div class="text-sm text-orange-600 bg-orange-50 px-2 py-1 rounded-lg">
                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                即将到期
                            </div>
                            <button class="bg-orange-500 text-white text-xs px-3 py-1 rounded-lg" onclick="remindUser('user6')">
                                <i class="fas fa-bell mr-1"></i>提醒
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部间距 -->
        <div class="h-20"></div>
    </div>

    <script>


        // 提醒用户
        function remindUser(userId) {
            if (confirm('确定要提醒该用户完成任务吗？')) {
                alert('已发送提醒通知给用户：' + userId);
            }
        }


        // 一键全部提醒未提交人员
        function remindAllNotSubmitted() {
            const notSubmittedPersons = document.querySelectorAll('.not-submitted-person');
            const count = notSubmittedPersons.length;
            
            if (count === 0) {
                alert('没有未提交的人员需要提醒');
                return;
            }
            
            if (confirm(`确定要提醒所有 ${count} 名未提交人员完成任务吗？`)) {
                // 模拟发送提醒
                let remindedCount = 0;
                notSubmittedPersons.forEach((person, index) => {
                    setTimeout(() => {
                        const nameElement = person.querySelector('h4');
                        const name = nameElement ? nameElement.textContent : `用户${index + 1}`;
                        console.log(`已发送提醒给：${name}`);
                        remindedCount++;
                        
                        if (remindedCount === count) {
                            alert(`已成功发送提醒给所有 ${count} 名未提交人员`);
                        }
                    }, index * 100); // 每100ms发送一个提醒，避免过于频繁
                });
            }
        }

        // 导出未提交人员
        function exportNotSubmitted() {
            const notSubmittedPersons = document.querySelectorAll('.not-submitted-person');
            const count = notSubmittedPersons.length;
            
            if (count === 0) {
                alert('没有未提交的人员可以导出');
                return;
            }
            
            // 收集未提交人员数据
            const notSubmittedData = [];
            notSubmittedPersons.forEach((person, index) => {
                const nameElement = person.querySelector('h4');
                const positionElement = person.querySelector('p');
                
                const name = nameElement ? nameElement.textContent : `用户${index + 1}`;
                const position = positionElement ? positionElement.textContent : '';
                
                notSubmittedData.push({
                    姓名: name,
                    职位: position,
                    状态: '未提交'
                });
            });
            
            // 转换为CSV格式
            const headers = ['姓名', '职位', '状态'];
            const csvContent = [
                headers.join(','),
                ...notSubmittedData.map(row => 
                    headers.map(header => `"${row[header] || ''}"`).join(',')
                )
            ].join('\n');
            
            // 创建下载链接
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `未提交人员_${new Date().toISOString().slice(0, 10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`已导出 ${count} 名未提交人员数据`);
        }

        // 返回上一页
        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html>
