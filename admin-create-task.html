<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发布任务 - 管理后台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="miniprogram-container">
        <!-- 导航栏 -->
        <div class="navbar" style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%);">
            <div class="flex items-center justify-between w-full">
                <div class="flex items-center">
                    <button class="mr-3 text-white" onclick="goBack()">
                        <i class="fas fa-arrow-left text-lg"></i>
                    </button>
                    <h1 class="text-lg font-bold">
                        <i class="fas fa-plus mr-2"></i>
                        发布任务
                    </h1>
                </div>
            </div>
        </div>

        <!-- 任务发布表单 -->
        <div class="px-4 py-4">
            <form id="taskForm" class="space-y-6">
                <!-- 基本信息 -->
                <div class="bg-white rounded-lg shadow-sm p-4">
                    <h3 class="font-bold text-lg mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                        基本信息
                    </h3>
                    
                    <div class="space-y-4">
                        <!-- 任务标题 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">任务标题 *</label>
                            <input type="text" id="taskTitle" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="请输入任务标题">
                        </div>

                        <!-- 任务描述 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">任务描述 *</label>
                            <textarea id="taskDescription" rows="3" required
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                      placeholder="请详细描述任务内容和要求"></textarea>
                        </div>

                        <!-- 发布文案 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">发布文案 *</label>
                            <textarea id="publishContent" rows="4" required
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                      placeholder="请输入朋友圈发布的文案内容"></textarea>
                        </div>

                        <!-- 任务类型 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">任务类型 *</label>
                            <select id="taskType" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">请选择任务类型</option>
                                <option value="promotion">促销推广</option>
                                <option value="product">产品宣传</option>
                                <option value="brand">品牌推广</option>
                                <option value="event">活动宣传</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 内容上传 -->
                <div class="bg-white rounded-lg shadow-sm p-4">
                    <h3 class="font-bold text-lg mb-4 flex items-center">
                        <i class="fas fa-upload mr-2 text-green-600"></i>
                        内容上传
                    </h3>
                    
                    <div class="space-y-4">
                        <!-- 文件上传区域 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">上传内容 *</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors"
                                 id="uploadArea">
                                <div class="upload-content">
                                    <i class="fas fa-image text-4xl text-gray-400 mb-4"></i>
                                    <p class="text-lg font-medium text-gray-600 mb-2">点击或拖拽上传图片</p>
                                    <p class="text-sm text-gray-500 mb-4">仅支持图片格式（JPG、PNG、GIF等）</p>
                                    <input type="file" id="fileInput" multiple accept="image/*" 
                                           class="hidden" onchange="handleFileSelect(event)">
                                    <button type="button" class="btn-primary" onclick="document.getElementById('fileInput').click()">
                                        <i class="fas fa-plus mr-1"></i>
                                        选择图片
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 已上传文件列表 -->
                            <div id="fileList" class="mt-4 space-y-2 hidden">
                                <!-- 文件项将通过JavaScript动态添加 -->
                            </div>
                        </div>

                        <!-- 内容预览 -->
                        <div id="contentPreview" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">内容预览</label>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div id="previewContent">
                                    <!-- 预览内容将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 任务设置 -->
                <div class="bg-white rounded-lg shadow-sm p-4">
                    <h3 class="font-bold text-lg mb-4 flex items-center">
                        <i class="fas fa-cog mr-2 text-purple-600"></i>
                        任务设置
                    </h3>
                    
                    <div class="space-y-4">
                        <!-- 发布时间 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">发布时间 *</label>
                            <input type="datetime-local" id="publishTime" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <!-- 截止时间 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">截止时间 *</label>
                            <input type="datetime-local" id="deadline" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <!-- 发布门店 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">发布门店</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="allStores" name="targetType" value="all" checked
                                           class="mr-2" onchange="toggleStoreSelection()">
                                    <label for="allStores" class="text-sm">所有门店</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="selectStores" name="targetType" value="select"
                                           class="mr-2" onchange="toggleStoreSelection()">
                                    <label for="selectStores" class="text-sm">指定门店</label>
                                </div>
                            </div>
                            
                            <!-- 门店选择器 -->
                            <div id="storeSelector" class="mt-3 hidden">
                                <div class="border border-gray-300 rounded-lg p-3 max-h-32 overflow-y-auto">
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2" value="store1">
                                            <span class="text-sm">北京朝阳店</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2" value="store2">
                                            <span class="text-sm">上海浦东店</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2" value="store3">
                                            <span class="text-sm">广州天河店</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2" value="store4">
                                            <span class="text-sm">深圳南山店</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2" value="store5">
                                            <span class="text-sm">杭州西湖店</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="flex space-x-3 pb-6">
                    <button type="button" class="btn-secondary flex-1" onclick="goBack()">
                        <i class="fas fa-times mr-1"></i>
                        取消
                    </button>
                    <button type="submit" class="btn-primary flex-1">
                        <i class="fas fa-paper-plane mr-1"></i>
                        发布任务
                    </button>
                </div>
            </form>
        </div>

        <!-- 底部间距 -->
        <div class="h-20"></div>
    </div>

    <script>
        // 文件上传处理
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const contentPreview = document.getElementById('contentPreview');
        const previewContent = document.getElementById('previewContent');

        // 拖拽上传
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('border-blue-400', 'bg-blue-50');
        });

        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-400', 'bg-blue-50');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        // 点击上传
        uploadArea.addEventListener('click', function() {
            fileInput.click();
        });

        // 文件选择处理
        function handleFileSelect(event) {
            const files = event.target.files;
            handleFiles(files);
        }

        // 处理文件
        function handleFiles(files) {
            Array.from(files).forEach(file => {
                addFileToList(file);
            });
            updatePreview();
        }

        // 添加文件到列表
        function addFileToList(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
            
            const fileInfo = document.createElement('div');
            fileInfo.className = 'flex items-center space-x-3';
            
            const icon = document.createElement('i');
            icon.className = 'fas fa-image text-blue-600';
            
            const fileName = document.createElement('span');
            fileName.className = 'text-sm font-medium';
            fileName.textContent = file.name;
            
            const fileSize = document.createElement('span');
            fileSize.className = 'text-xs text-gray-500';
            fileSize.textContent = formatFileSize(file.size);
            
            fileInfo.appendChild(icon);
            fileInfo.appendChild(fileName);
            fileInfo.appendChild(fileSize);
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'text-red-500 hover:text-red-700';
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            removeBtn.onclick = function() {
                fileItem.remove();
                updatePreview();
            };
            
            fileItem.appendChild(fileInfo);
            fileItem.appendChild(removeBtn);
            
            fileList.appendChild(fileItem);
            fileList.classList.remove('hidden');
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 更新预览
        function updatePreview() {
            const files = fileList.querySelectorAll('div');
            if (files.length > 0) {
                contentPreview.classList.remove('hidden');
                // 这里可以添加实际的预览逻辑
                previewContent.innerHTML = `
                    <div class="text-center text-gray-500">
                        <i class="fas fa-eye text-2xl mb-2"></i>
                        <p>已选择 ${files.length} 个文件</p>
                        <p class="text-sm">点击"预览"按钮查看详细内容</p>
                    </div>
                `;
            } else {
                contentPreview.classList.add('hidden');
            }
        }

        // 门店选择切换
        function toggleStoreSelection() {
            const selector = document.getElementById('storeSelector');
            const selectStores = document.getElementById('selectStores');
            
            if (selectStores.checked) {
                selector.classList.remove('hidden');
            } else {
                selector.classList.add('hidden');
            }
        }

        // 返回上一页
        function goBack() {
            if (confirm('确定要离开吗？未保存的内容将丢失。')) {
                window.history.back();
            }
        }



        // 表单提交
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const taskData = Object.fromEntries(formData.entries());
            
            // 验证必填字段
            if (!taskData.taskTitle || !taskData.taskDescription || !taskData.publishContent || !taskData.taskType) {
                alert('请填写所有必填字段');
                return;
            }
            
            // 检查文件上传
            const files = fileList.querySelectorAll('div');
            if (files.length === 0) {
                alert('请至少上传一个文件');
                return;
            }
            
            // 检查时间设置
            if (!taskData.publishTime || !taskData.deadline) {
                alert('请设置发布时间和截止时间');
                return;
            }
            
            if (new Date(taskData.publishTime) >= new Date(taskData.deadline)) {
                alert('截止时间必须晚于发布时间');
                return;
            }
            
            // 提交任务
            alert('任务发布成功！');
            // 这里可以添加实际的提交逻辑
            // window.location.href = 'admin-tasks.html';
        });

        // 设置默认时间
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
            
            document.getElementById('publishTime').value = now.toISOString().slice(0, 16);
            document.getElementById('deadline').value = tomorrow.toISOString().slice(0, 16);
        });
    </script>
</body>
</html>
