<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提交凭证 - 朋友圈转发管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="miniprogram-container">
        <!-- 任务信息 -->
        <div class="bg-white mx-4 mt-4 rounded-lg shadow-sm p-4">
            <div class="flex items-start space-x-3">
                <img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=60&h=60&fit=crop&crop=center" 
                     alt="任务" class="w-15 h-15 rounded-lg object-cover">
                <div class="flex-1">
                    <h3 class="font-bold text-gray-800">周末大促销活动</h3>
                    <p class="text-sm text-gray-600 mt-1">转发促销推文到朋友圈</p>
                    <div class="flex items-center mt-2 text-xs text-gray-500">
                        <i class="fas fa-clock mr-1"></i>
                        <span>截止时间：今日 18:00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 截图要求说明 -->
        <div class="mx-4 mt-4">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-start">
                    <i class="fas fa-exclamation-triangle text-yellow-600 mr-3 mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-yellow-800 mb-2">截图要求</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>• 截图需包含朋友圈完整内容</li>
                            <li>• 显示发布时间和您的微信昵称</li>
                            <li>• 确保图片清晰可见</li>
                            <li>• 可上传多张截图补充信息</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- 截图示例 -->
        <div class="mx-4 mt-4">
            <h3 class="font-semibold text-gray-800 mb-3">
                <i class="fas fa-image mr-2 text-blue-600"></i>
                截图示例
            </h3>
            <div class="bg-gray-100 rounded-lg p-4 text-center">
                <img src="https://images.unsplash.com/photo-1611224923853-80b023f02d71?w=200&h=300&fit=crop&crop=center" 
                     alt="朋友圈截图示例" class="w-48 h-72 mx-auto rounded-lg shadow-sm object-cover">
                <p class="text-sm text-gray-600 mt-2">朋友圈转发截图示例</p>
            </div>
        </div>

        <!-- 上传区域 -->
        <div class="mx-4 mt-4">
            <h3 class="font-semibold text-gray-800 mb-3">
                <i class="fas fa-upload mr-2 text-green-600"></i>
                上传截图
            </h3>
            
            <!-- 上传区域 -->
            <div class="upload-area" id="uploadArea">
                <div class="text-center">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                    <p class="text-gray-600 font-medium">点击上传截图</p>
                    <p class="text-sm text-gray-500 mt-1">支持 JPG、PNG 格式</p>
                    <input type="file" id="fileInput" class="hidden" multiple accept="image/*">
                </div>
            </div>

            <!-- 已上传的图片预览 -->
            <div id="imagePreview" class="mt-4 grid grid-cols-2 gap-3 hidden">
                <!-- 动态生成的图片预览 -->
            </div>
        </div>

        <!-- 简要说明 -->
        <div class="mx-4 mt-4">
            <h3 class="font-semibold text-gray-800 mb-3">
                <i class="fas fa-edit mr-2 text-purple-600"></i>
                简要说明
            </h3>
            <textarea 
                id="description" 
                placeholder="请简要说明转发情况（可选）..."
                class="w-full h-24 p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            ></textarea>
        </div>

        <!-- 提交按钮 -->
        <div class="mx-4 mt-6 mb-20">
            <button id="submitBtn" class="btn-primary w-full py-3 text-lg" disabled>
                <i class="fas fa-paper-plane mr-2"></i>
                提交凭证
            </button>
        </div>

    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const submitBtn = document.getElementById('submitBtn');
        const description = document.getElementById('description');
        
        let uploadedFiles = [];

        // 点击上传区域触发文件选择
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        // 拖拽上传
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        // 文件选择处理
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    uploadedFiles.push(file);
                    displayImagePreview(file);
                }
            });
            
            // 更新上传区域显示
            if (uploadedFiles.length > 0) {
                uploadArea.style.display = 'none';
                imagePreview.classList.remove('hidden');
                checkSubmitButton();
            }
        }

        function displayImagePreview(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const imageContainer = document.createElement('div');
                imageContainer.className = 'relative group';
                
                imageContainer.innerHTML = `
                    <img src="${e.target.result}" 
                         alt="上传的截图" 
                         class="w-full h-32 object-cover rounded-lg shadow-sm">
                    <button class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"
                            onclick="removeImage(this)">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                `;
                
                imagePreview.appendChild(imageContainer);
            };
            reader.readAsDataURL(file);
        }

        function removeImage(button) {
            const imageContainer = button.closest('.relative');
            const index = Array.from(imagePreview.children).indexOf(imageContainer);
            
            uploadedFiles.splice(index, 1);
            imageContainer.remove();
            
            if (uploadedFiles.length === 0) {
                uploadArea.style.display = 'block';
                imagePreview.classList.add('hidden');
            }
            
            checkSubmitButton();
        }

        function checkSubmitButton() {
            if (uploadedFiles.length > 0) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        // 提交表单
        submitBtn.addEventListener('click', () => {
            if (uploadedFiles.length === 0) {
                alert('请至少上传一张截图');
                return;
            }

            // 显示加载状态
            submitBtn.innerHTML = '<div class="loading mr-2"></div>提交中...';
            submitBtn.disabled = true;

            // 模拟提交过程
            setTimeout(() => {
                alert('凭证提交成功！等待管理员审核。');
                
                // 重置表单
                uploadedFiles = [];
                imagePreview.innerHTML = '';
                imagePreview.classList.add('hidden');
                uploadArea.style.display = 'block';
                description.value = '';
                fileInput.value = '';
                
                // 恢复按钮状态
                submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>提交凭证';
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                
                // 返回上一页
                setTimeout(() => {
                    history.back();
                }, 1500);
            }, 2000);
        });

        // 初始化
        checkSubmitButton();
    </script>
</body>
</html>
